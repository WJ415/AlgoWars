//@version=6
// =============================
// AlgoWars 固定框架（不要改动除“用户策略区”之外的任何代码）
// =============================
strategy("模板-MACD策略", 
     overlay=false,           // 固定：副图
     pyramiding=0,            // 固定：禁止同向加仓
     initial_capital=100000,  // 固定：初始资金 100k USD
     currency=currency.USD,   // 固定：USD 计价
     slippage=1,              // 固定：1 tick 滑点
     process_orders_on_close=true)  // 固定：收盘撮合；不要改

// —— 固定：统一用 UTC 起始时间（限制“入场”的开始时点）——
startT = timestamp(2000, 1, 1, 0, 0)
endT = timestamp(2025, 11, 1, 0, 0)
inRange = time >= startT and time <= endT  // 注意：time 为 UTC 毫秒时间戳



// =====================================================
// =============== 用户策略区（只改这里） ===============

// 策略名称：MACD 信号交叉策略（MACD Signal Cross）
// 策略逻辑简介：
//     本策略利用 MACD 指标的快线（macd）与信号线（signal）之间的交叉判断趋势方向。
//     当 MACD 向上突破 signal 时，视为多头动能增强 → 开多；
//     当 MACD 向下跌破 signal 时，视为空头动能增强 → 开空；
//     同时以 MACD 穿越零轴作为出场信号，用于在趋势减弱时及时止盈。


// 在这里写你的交易信号与开平仓逻辑；建议使用 barstate.isconfirmed
// 例：MACD 示意（可全部替换为你的逻辑）
// -----------------------------------------------------
[macd, sig, _] = ta.macd(close, 12, 26, 9)

longEnter  = inRange and ta.crossover(macd, sig) and barstate.isconfirmed
longExit   = inRange and ta.crossunder(macd, 0)  and barstate.isconfirmed

if longEnter and strategy.position_size <= 0
    if strategy.position_size < 0
        strategy.close("S")           // 先平空（如有）
    strategy.entry("L", strategy.long)

if longExit and strategy.position_size > 0
    strategy.close("L")

// 如需做空，请自行添加空头逻辑，并确保使用不同 ID（例如 "S"）




// ============= 用户策略区结束（以上可改） =============
// =====================================================




// —— 固定：可视化（总资产USD + 最大回撤USD），不要改 —— 
eq = inRange ? strategy.equity : na

var float peak  = na
var float maxDD = na

if inRange
    // 维护峰值与最大回撤（USD，≤0）
    peak  := na(peak) ? eq : math.max(peak, eq)
    currDD = eq - peak
    maxDD := na(maxDD) ? currDD : math.min(maxDD, currDD)
else
    peak  := na
    maxDD := na

plot(eq,       "Equity (USD)",        format=format.price, linewidth=2)
plot(maxDD,    "Max Drawdown (USD)",  format=format.price, linewidth=2)
hline(100000,  "Initial 100k",        linestyle=hline.style_dotted)


